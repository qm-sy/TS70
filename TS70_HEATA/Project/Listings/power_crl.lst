C51 COMPILER V9.60.7.0   POWER_CRL                                                         11/21/2025 17:16:31 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE POWER_CRL
OBJECT MODULE PLACED IN ..\Output\power_crl.obj
COMPILER INVOKED BY: D:\APP\KEIL\MDK\C51\BIN\C51.EXE ..\BSP\Src\power_crl.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(..\BSP
                    -\Inc;..\Core\Inc;..\Driver;..\Emembed\Inc;..\SYSTEM\Inc) DEBUG OBJECTEXTEND PRINT(.\Listings\power_crl.lst) TABS(2) OBJE
                    -CT(..\Output\power_crl.obj)

line level    source

   1          #include "power_crl.h"
   2          
   3          SLAVE_06 slave_06;
   4          POWER_CTRL power_ctrl;
   5          
   6          
   7          void Power_Init( void )
   8          {
   9   1          /*  å¼€æœºçŠ¶æ€ç½®ä¸€                */
  10   1          power_ctrl.power_switch = 1;
  11   1      
  12   1          AC_Out1 = AC_Out2 = AC_Out3 = AC_OFF;
  13   1      
  14   1          Buzzer = BUZZER_OFF;
  15   1          slave_06.sync_signal_turndown = 0;
  16   1          slave_06.sync_switch_delay = 0;
  17   1      }
  18          
  19          /**
  20           * @brief æ¸©åº¦æ‰«æï¼ŒDHT11æ¸©æ¹¿åº¦æ‰«æ 1s/æ¬¡ æ§åˆ¶220Vè¾“å‡ºä½¿èƒ½
  21           *
  22           * @param[in] 
  23           * 
  24           * @return  
  25           * 
  26          **/
  27          void temp_scan( void )
  28          {
  29   1          uint16_t *temp_val = NULL;
  30   1      
  31   1          if( temp.scan_flag == 1 )
  32   1          {
  33   2              temp_val = max6675_readTemp();
  34   2      
  35   2              temp.thermo1_temp = temp_val[0];
  36   2              temp.thermo2_temp = temp_val[1];
  37   2              temp.thermo3_temp = temp_val[2];
  38   2      
  39   2              temp.scan_flag = 0;
  40   2          }
  41   1      }
  42          
  43          /**
  44           * @brief AC DCè¾“å‡ºä½¿èƒ½æ§åˆ¶
  45           *
  46           * @param[in] 
  47           * 
  48           * @return  
  49           * 
  50          **/
  51          void ac_dc_ctrl( void )
  52          {
  53   1          if( power_ctrl.power_switch == 1 )
C51 COMPILER V9.60.7.0   POWER_CRL                                                         11/21/2025 17:16:31 PAGE 2   

  54   1          {
  55   2              power_ctrl.AC1_enable = heat_enable_judge(slave_06.F_HeatSwitch,
  56   2                                                        temp.thermo1_temp,            // æ¸©åº¦ä¼ æ„Ÿå™¨1çš„å½“å
             -‰å€¼
  57   2                                                        slave_06.F_HeatTemp           // é€šé“Fçš„åŠ çƒ­ç›®æ ‡æ
             -¸©åº¦
  58   2                                                        ) ? ENABLE : DISABLE;         // æ ¹æ®å‡½æ•°è¿”å›å€¼è®
             -¾ç½®ä½¿èƒ½çŠ¶æ€
  59   2      
  60   2              power_ctrl.AC2_enable = heat_enable_judge(slave_06.M_HeatSwitch,
  61   2                                                        temp.thermo2_temp,            // æ¸©åº¦ä¼ æ„Ÿå™¨2çš„å½“å
             -‰å€¼
  62   2                                                        slave_06.M_HeatTemp           // é€šé“Mçš„åŠ çƒ­ç›®æ ‡æ
             -¸©åº¦
  63   2                                                        ) ? ENABLE : DISABLE;         // æ ¹æ®å‡½æ•°è¿”å›å€¼è®
             -¾ç½®ä½¿èƒ½çŠ¶æ€
  64   2      
  65   2              power_ctrl.AC3_enable = heat_enable_judge(slave_06.R_HeatSwitch,
  66   2                                                        temp.thermo3_temp,            // æ¸©åº¦ä¼ æ„Ÿå™¨3çš„å½“å
             -‰å€¼
  67   2                                                        slave_06.R_HeatTemp          // é€šé“Rçš„åŠ çƒ­ç›®æ ‡æ¸
             -©åº¦
  68   2                                                        ) ? ENABLE : DISABLE;         // æ ¹æ®å‡½æ•°è¿”å›å€¼è®
             -¾ç½®ä½¿èƒ½çŠ¶æ€
  69   2      
  70   2              power_ctrl.FanTemp_enable = ENABLE;
  71   2      
  72   2              motor_enable_judge();
  73   2          }else
  74   1          {
  75   2              power_ctrl.AC1_enable = power_ctrl.AC2_enable = power_ctrl.AC3_enable = DISABLE;
  76   2              power_ctrl.FanTemp_enable = DISABLE;
  77   2              PWMB_ENO = 0;
  78   2          }
  79   1          
  80   1          AC_Out1  = (power_ctrl.AC1_enable == ENABLE) ? AC_ON  : AC_OFF;
  81   1          AC_Out2  = (power_ctrl.AC2_enable == ENABLE) ? AC_ON  : AC_OFF;
  82   1          AC_Out3  = (power_ctrl.AC3_enable == ENABLE) ? AC_ON  : AC_OFF;
  83   1          Fan_Temp = (power_ctrl.FanTemp_enable == ENABLE) ? FAN_ON  : FAN_OFF;
  84   1          PWMB_CCR5 = 183 * slave_06.SF_level;
  85   1          PWMB_CCR6 = PWMB_CCR7 = 183 * slave_06.HF_level;
  86   1      }
  87          
  88          
  89          /**
  90           * @brief ACè¾“å‡ºä½¿èƒ½åˆ¤æ–­
  91           *
  92           * @param[in] ntc_value,        å½“å‰æ¸©åº¦å€¼
  93                        ntc_heat_temp,    åŠ çƒ­ç›®æ ‡æ¸©åº¦  
  94                        pre_temp,         é¢„åŠ çƒ­æ¸©åº¦
  95           * 
  96           * @return  
  97           * 
  98          **/
  99          uint8_t heat_enable_judge(uint8_t CH_switch, uint8_t TherMo_value, uint8_t CH_heat_temp)                 
 100          {
 101   1          // ç¬¬1å±‚æ£€æŸ¥ï¼šåŠ çƒ­å¼€å…³
 102   1          if( CH_switch == 0 )
 103   1          {
 104   2              return DISABLE;
 105   2          }
 106   1          
C51 COMPILER V9.60.7.0   POWER_CRL                                                         11/21/2025 17:16:31 PAGE 3   

 107   1          // ç¬¬2å±‚æ£€æŸ¥ï¼šåŠ çƒ­éœ€æ±‚
 108   1          // å¦‚æœæ¸©åº¦å·²ç»è¾¾åˆ°åŠ çƒ­ç›®æ ‡æ¸©åº¦ï¼Œç«‹å³è¿”å› 0ï¼ˆä¸åŠ çƒ­ï¼‰
 109   1          if ( TherMo_value >= CH_heat_temp ) 
 110   1          {
 111   2              return DISABLE;
 112   2          }
 113   1          
 114   1          // ç¬¬3å±‚æ£€æŸ¥ï¼šå·¥ä½œæ¨¡å¼  åŒæ­¥æ¨¡å¼ä¸‹ï¼Œæ— åŒæ­¥ä¿¡å·åˆ™ä¸è¿›è¡ŒåŠ çƒ­
 115   1          if ( slave_06.sync_switch == SW_OPEN ) 
 116   1          {  
 117   2              if ( slave_06.sync_signal == 0 )         
 118   2              {
 119   3                 return DISABLE;
 120   3              }
 121   2          }
 122   1          
 123   1          // å…¶ä»–æƒ…å†µï¼šå…è®¸åŠ çƒ­
 124   1          return ENABLE;
 125   1      }
 126          
 127          void motor_enable_judge( void )
 128          {
 129   1          sync_signal_listen();
 130   1          sync_switch_listen();
 131   1      
 132   1          if( slave_06.sync_switch == 0 )
 133   1          {
 134   2              motor_state_set();
 135   2          }else
 136   1          {
 137   2              if( slave_06.sync_signal == 0 )
 138   2              {
 139   3                  if( slave_06.sync_signal_turndown == 1 )
 140   3                  {
 141   4                      PWMB_ENO &= 0xeb;
 142   4                  }else
 143   3                  {
 144   4                      PWMB_ENO = 0;
 145   4                  }
 146   3              }
 147   2          }
 148   1      }
 149          
 150          void motor_state_set( void )
 151          {
 152   1          if( slave_06.sync_switch_delay == 0 )
 153   1          {
 154   2              if (slave_06.SF_Switch == 1) 
 155   2              {
 156   3                  PWMB_ENO = (slave_06.HF_Switch == 1) ? 
 157   3                          (slave_06.HF_Direction == 1 ? 0x11 : 0x05) : 0x01;
 158   3              }else 
 159   2              {
 160   3                  PWMB_ENO = (slave_06.HF_Switch == 1) ? 
 161   3                          (slave_06.HF_Direction == 1 ? 0x10 : 0x04) : 0x00;
 162   3              }
 163   2          }else
 164   1          {
 165   2              PWMB_ENO = 0;
 166   2          }
 167   1      
 168   1      }
C51 COMPILER V9.60.7.0   POWER_CRL                                                         11/21/2025 17:16:31 PAGE 4   

 169          
 170          /**
 171           * @brief åŒæ­¥ä¿¡å·ç›‘å¬ åŒæ—¶æ»¡è¶³æœ‰åŒæ­¥ä¸”åŒæ­¥ä¿¡å·ä»1â†“0æ—¶è§¦å‘é£æ‰‡å»¶æ—¶è¾“å‡º
 172           *
 173           * @param   
 174           *
 175           * @return  void
 176          **/
 177          void sync_signal_listen( void )
 178          {
 179   1          static uint8_t signal_flag = 0;
 180   1      
 181   1          if( signal_flag != slave_06.sync_signal )
 182   1          {
 183   2              signal_flag = slave_06.sync_signal;
 184   2      
 185   2              if( slave_06.sync_switch == 1 )     //åŒæ­¥æ¨¡å¼ä¸‹
 186   2              {
 187   3                  if( signal_flag == 0 )          //åŒæ­¥ä¿¡å· 1 â†’â†’ 0  J1å»¶æ—¶
 188   3                  {
 189   4                      slave_06.sync_signal_turndown = 1;
 190   4                  }else                           //åŒæ­¥ä¿¡å· 0 â†’â†’ 1  J2J3å¤ä½
 191   3                  {
 192   4                      slave_06.hf_reset_flag = 1;
 193   4                  }
 194   3              }
 195   2          }
 196   1      }
 197          
 198          /**
 199           * @brief åŒæ­¥ä¿¡å·ç›‘å¬ åŒæ—¶æ»¡è¶³æœ‰åŒæ­¥ä¸”åŒæ­¥ä¿¡å·ä»1â†“0æ—¶è§¦å‘é£æ‰‡å»¶æ—¶è¾“å‡º
 200           *
 201           * @param   
 202           *
 203           * @return  void
 204          **/
 205          void sync_switch_listen( void )
 206          {
 207   1          static uint8_t switch_flag = 0;
 208   1      
 209   1          if( switch_flag != slave_06.sync_switch )
 210   1          {
 211   2              switch_flag = slave_06.sync_switch;
 212   2      
 213   2              if(( switch_flag == 1 ) && ( slave_06.sync_signal == 1 ))       //æ‰‹åŠ¨ â†’â†’ è‡ªåŠ¨ ä¸”æœ‰åŒæ­
             -¥ä¿¡å·J2J3å¤ä½
 214   2              {
 215   3                  slave_06.hf_reset_flag = 1;
 216   3              }
 217   2      
 218   2              if( switch_flag == 0 )
 219   2              {
 220   3                  slave_06.sync_switch_delay = 1;
 221   3              }
 222   2          }
 223   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    548    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     29    ----
C51 COMPILER V9.60.7.0   POWER_CRL                                                         11/21/2025 17:16:31 PAGE 5   

   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
